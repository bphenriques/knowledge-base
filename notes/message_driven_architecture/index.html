<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Asyncronous and non-blocking. The sender does not actively wait for a response.
Advantages:
 Resources are freed immediatly. Reduced contention Messages can be queued for deleivery in case the receiver&rsquo;s is offline. Provides a higher level of reliability.  Disavantages:
 Make transactions more difficult. How to manage long running transactions that span multiple microservices. Holding transactions open for long periods result in slow, brittle systems.  The role of syncronous messags:"><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Message Driven Architecture"><meta property="og:description" content="Asyncronous and non-blocking. The sender does not actively wait for a response.
Advantages:
 Resources are freed immediatly. Reduced contention Messages can be queued for deleivery in case the receiver&rsquo;s is offline. Provides a higher level of reliability.  Disavantages:
 Make transactions more difficult. How to manage long running transactions that span multiple microservices. Holding transactions open for long periods result in slow, brittle systems.  The role of syncronous messags:"><meta property="og:type" content="article"><meta property="og:url" content="https://bphenriques.github.io/knowledge-base/notes/message_driven_architecture/"><meta property="article:section" content="notes"><title>Message driven architecture | Bruno Henriques's Digital Garden ðŸŒ±</title><link rel=icon href=/knowledge-base/favicon.png type=image/x-icon><link rel=stylesheet href=/knowledge-base/scss/explorer.min.567717050ac2a9fa772b17e11a0a1e0f19c73dc0772ac29530c27ddb3558efb2.css integrity="sha256-VncXBQrCqfp3KxfhGgoeDxnHPcB3KsKVMMJ92zVY77I=" crossorigin=anonymous><script defer src=/knowledge-base/js/vendor/flexsearch.bundle.js></script><script defer src=/knowledge-base/js/search.min.ba9436b8bf765a447ed9dcce6548337abda2fa9bab826d03a85b9cc699788a7a.js integrity="sha256-upQ2uL92WkR+2dzOZUgzer2i+purgm0DqFucxpl4ino=" crossorigin=anonymous></script></head><body><input type=checkbox class="hidden toggle" id=site-menu-control>
<input type=checkbox class="hidden toggle" id=content-menu-control><main class="container flex"><aside class=site-menu><div class=site-menu-content><nav><h2 class=brand><a class="flex align-center" href=/knowledge-base/><span>Bruno Henriques</span></a></h2><div class=search><input type=text id=search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="search-spinner hidden"></div><ul id=search-results class=item-preview-list></ul></div><a class=site-menu-shortcut-link href=/knowledge-base/notes>Recent Notes</a><p class=site-menu-tags-title><b>Tags</b></p><ul><li><a class=list-tag-item href=/knowledge-base/tags/akka><div class=tag-dot style=background-color:#ffecb3></div>Akka</a></li><li><a class=list-tag-item href=/knowledge-base/tags/concurrency><div class=tag-dot style=background-color:#f5f5f5></div>Concurrency</a></li><li><a class=list-tag-item href=/knowledge-base/tags/data><div class=tag-dot style=background-color:#ffe0b2></div>Data</a></li><li><a class=list-tag-item href=/knowledge-base/tags/data-structures><div class=tag-dot style=background-color:#ffcdd2></div>Data structures</a></li><li><a class=list-tag-item href=/knowledge-base/tags/databases><div class=tag-dot style=background-color:#f1f8e9></div>Databases</a></li><li><a class=list-tag-item href=/knowledge-base/tags/dispatcher><div class=tag-dot style=background-color:#c8e6c9></div>Dispatcher</a></li><li><a class=list-tag-item href=/knowledge-base/tags/editors><div class=tag-dot style=background-color:#ffb74d></div>Editors</a></li><li><a class=list-tag-item href=/knowledge-base/tags/json><div class=tag-dot style=background-color:#ffebee></div>JSON</a></li><li><a class=list-tag-item href=/knowledge-base/tags/jvm><div class=tag-dot style=background-color:#90caf9></div>Jvm</a></li><li><a class=list-tag-item href=/knowledge-base/tags/learning><div class=tag-dot style=background-color:#dcedc8></div>Learning</a></li><li><a class=list-tag-item href=/knowledge-base/tags/lightbend><div class=tag-dot style=background-color:#f0f4c3></div>Lightbend</a></li><li><a class=list-tag-item href=/knowledge-base/tags/messaging><div class=tag-dot style=background-color:#f0f4c3></div>Messaging</a></li><li><a class=list-tag-item href=/knowledge-base/tags/monitoring><div class=tag-dot style=background-color:#e3f2fd></div>Monitoring</a></li><li><a class=list-tag-item href=/knowledge-base/tags/note><div class=tag-dot style=background-color:#bbdefb></div>Note</a></li><li><a class=list-tag-item href=/knowledge-base/tags/protocols><div class=tag-dot style=background-color:#ab9df2></div>Protocols</a></li><li><a class=list-tag-item href=/knowledge-base/tags/router><div class=tag-dot style=background-color:#c8e6c9></div>Router</a></li><li><a class=list-tag-item href=/knowledge-base/tags/scala><div class=tag-dot style=background-color:#ffd180></div>Scala</a></li><li><a class=list-tag-item href=/knowledge-base/tags/security><div class=tag-dot style=background-color:#b3e5fc></div>Security</a></li><li><a class=list-tag-item href=/knowledge-base/tags/signing><div class=tag-dot style=background-color:#ffd866></div>Signing</a></li><li><a class=list-tag-item href=/knowledge-base/tags/snippets><div class=tag-dot style=background-color:#e1f5fe></div>Snippets</a></li><li><a class=list-tag-item href=/knowledge-base/tags/stream><div class=tag-dot style=background-color:#d1c4e9></div>Stream</a></li><li><a class=list-tag-item href=/knowledge-base/tags/system-design><div class=tag-dot style=background-color:#ffebee></div>System design</a></li><li><a class=list-tag-item href=/knowledge-base/tags/uncategorized><div class=tag-dot style=background-color:#90caf9></div>Uncategorized</a></li><li><a class=list-tag-item href=/knowledge-base/tags/work><div class=tag-dot style=background-color:#f5f5f5></div>Work</a></li><li><a class=list-tag-item href=/knowledge-base/tags/zettelkasten><div class=tag-dot style=background-color:#e3f2fd></div>Zettelkasten</a></li></ul></nav></div></aside><div class=page><header class=mobile-navigation-header><div class="flex align-center justify-between"><label for=site-menu-control><img src=/knowledge-base/svg/menu-page.svg class=icon alt="Page Menu"></label>
<strong>Message driven architecture</strong>
<label for=content-menu-control><img src=/knowledge-base/svg/menu-content.svg class=icon alt="Content Menu"></label></div></header><article class=markdown><h1 class=post-title><a href=/knowledge-base/notes/message_driven_architecture/>Message driven architecture</a></h1><p>Asyncronous and non-blocking. The sender does not actively wait for a response.</p><p>Advantages:</p><ul><li>Resources are freed immediatly.</li><li>Reduced contention</li><li>Messages can be queued for deleivery in case the receiver&rsquo;s is offline. Provides a higher level of reliability.</li></ul><p>Disavantages:</p><ul><li>Make transactions more difficult.</li><li>How to manage long running transactions that span multiple microservices.</li><li>Holding transactions open for long periods result in slow, brittle systems.</li></ul><p>The role of syncronous messags:</p><ul><li>Can you acknowledge the message but process it asyncronously?</li><li>The need for syncronous messages should be driven by domain requirements rather than technical convenience.</li></ul><h2 id=sagas>Sagas
<a class=anchor href=#sagas>#</a></h2><p>Represent long running transaction. Multiple requests are managed by a Saga.</p><p>Individual requests are run in sequence or in paralel.</p><p>How:</p><ul><li>Each request is paired with a compensating action.</li><li>If any requests fails, compnesation actions are executed for all completed steps.</li><li>Then the saga is completed with a failure.</li><li>If compensation actions fails, then it is retried. This requires idempotency.</li></ul><p>Timeouts in distributed systems:</p><ul><li><p>Eitehr the request failed.</p></li><li><p>Either it was successful but the reply failed.</p></li><li><p>The request is still queued and may success or fail eventually.</p><p>Compensating actions != Rollbacks.</p><p>Rollback: implies the transaction has not completed which removes the evidence of the transaction.
Compensation: Applied on top of a previously completed action. Evidence of the orignal action remains.</p></li></ul><p>Disavantages:</p><ul><li>Coupled to the failures unless we can move regardless of that.</li><li>Saga are often implemented using ackka actors and represented via Finite State Machine.</li></ul><h2 id=two-general-problem>Two General Problem
<a class=anchor href=#two-general-problem>#</a></h2><p>Illustrate the impossibility of reaching a concensus over an unreliable communication channel.</p><h2 id=delivery-guarantees>Delivery Guarantees
<a class=anchor href=#delivery-guarantees>#</a></h2><ul><li>Exactly Once: Is not possible in the event of a network partition, or lost message. We never guarantee that the message was in-fact sent. Failure requires resending the message which creates <em>potential</em> duplicates. Reuqires storage on both ends: unreliable network (as always); timeouts.</li><li>At most once - If a failure occur, no retries are done which means no duplications but there may be losses. Requires no storage of messages.</li><li>At least once - Require a acknoledge and teh sender needs to store state to track whether the messsage was acknowledge. It ahs to be stored in a durable data store.</li></ul><p>Exactly once can be simulated using at least once and idempotency.</p><p>Akka: at most once by default. Akka persistence has option to have at least once.</p><h2 id=messaging-patterns>Messaging Patterns
<a class=anchor href=#messaging-patterns>#</a></h2><h3 id=publish-subscribe>Publish Subscribe
<a class=anchor href=#publish-subscribe>#</a></h3><p>Decoupled. The only coupling is on the message format and possibily the location (e.g., url, exchange on the message broker). Complexity is hard to see as we do not know where the message comes from.</p><h3 id=point-to-point>Point to point
<a class=anchor href=#point-to-point>#</a></h3><p>Dependencies more clear but coupling is higher. COmplexity is directly observable.</p><h3 id=examples>Examples
<a class=anchor href=#examples>#</a></h3><p>Kafaka, RabbitMQ. Kafka allows point to point and pub/sub and we can even acknowledge once we finish processing.</p><p>Akka: Typically point to point messaging;Persistence Query: Pub/sub
Lagom: Point to point communication between services. Messages broker API allow for pub/sub.</p></article><footer class=page-footer></footer><label for=site-menu-control class="hidden site-menu-overlay"></label><label for=content-menu-control class="hidden content-menu-overlay"></label></div><aside class=content-menu><div class=content-menu-content><div class=toc-tags><p class=toc-title>Tags</p><div class=list-item-tag style=background-color:#ffebee>System design</div></div><p class=toc-title>Table Of Contents</p><nav id=TableOfContents><ul><li><a href=#sagas>Sagas</a></li><li><a href=#two-general-problem>Two General Problem</a></li><li><a href=#delivery-guarantees>Delivery Guarantees</a></li><li><a href=#messaging-patterns>Messaging Patterns</a><ul><li><a href=#publish-subscribe>Publish Subscribe</a></li><li><a href=#point-to-point>Point to point</a></li><li><a href=#examples>Examples</a></li></ul></li></ul></nav><nav class=backlinks><p class=toc-title>Mentioned In</p><ul class=item-preview-list><li><a href=/knowledge-base/notes/microservices/><div class=item-preview><span class=item-preview-title>Microservices</span><br><span class=item-preview-content>Subset of Service Oriented Architecture (SOA) where each service is deployed separately: â€¦</span></div></a></li></ul></nav></div></aside></main></body></html>
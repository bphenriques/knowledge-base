<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Subset of Service Oriented Architecture (SOA) where each service is deployed separately:
 Microservices can be physically separated and independently deployed. Each have its own data store. Independent and self governing. Communication is syncronous or asyncronous (e.g., through messaging systems). Loose coupling between components (more or less by experience but that is design flaw likely :thinking:). Shorter development and release cycles. Each scale independently (either through physical or virtual machines).  Advantages #   Deployed/Scaled as needed."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Microservices"><meta property="og:description" content="Subset of Service Oriented Architecture (SOA) where each service is deployed separately:
 Microservices can be physically separated and independently deployed. Each have its own data store. Independent and self governing. Communication is syncronous or asyncronous (e.g., through messaging systems). Loose coupling between components (more or less by experience but that is design flaw likely :thinking:). Shorter development and release cycles. Each scale independently (either through physical or virtual machines).  Advantages #   Deployed/Scaled as needed."><meta property="og:type" content="article"><meta property="og:url" content="https://bphenriques.github.io/knowledge-base/notes/microservices/"><meta property="article:section" content="notes"><title>Microservices | Bruno Henriques's Digital Garden ðŸŒ±</title><link rel=icon href=/knowledge-base/favicon.png type=image/x-icon><link rel=stylesheet href=/knowledge-base/scss/explorer.min.fff1aaee6fb1e5a74069ac1205647344fa7bf178f7f20b3abcf095b18d0c24fe.css integrity="sha256-//Gq7m+x5adAaawSBWRzRPp78Xj38gs6vPCVsY0MJP4=" crossorigin=anonymous><script defer src=/knowledge-base/js/vendor/flexsearch.bundle.js></script><script defer src=/knowledge-base/js/search.min.b6afd1c02733047b79f4611cc21b2dba445fb8844a6ca9d4e3d3eca6da9c378a.js integrity="sha256-tq/RwCczBHt59GEcwhstukRfuIRKbKnU49PsptqcN4o=" crossorigin=anonymous></script></head><body><input type=checkbox class="hidden toggle" id=site-menu-control>
<input type=checkbox class="hidden toggle" id=content-menu-control><main class="container flex"><aside class=site-menu><div class=site-menu-content><nav><h2 class=brand><a class="flex align-center" href=/knowledge-base/><span>Bruno Henriques</span></a></h2><div class=search><input type=text id=search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="search-spinner hidden"></div><ul id=search-results class=item-preview-list></ul></div><a class=site-menu-shortcut-link href=/knowledge-base/notes>Recent Notes</a><p class=site-menu-tags-title><b>Tags</b></p><ul><li><a class=list-tag-item href=/knowledge-base/tags/akka><div class=tag-dot style=background-color:#ffecb3></div>Akka</a></li><li><a class=list-tag-item href=/knowledge-base/tags/concurrency><div class=tag-dot style=background-color:#f5f5f5></div>Concurrency</a></li><li><a class=list-tag-item href=/knowledge-base/tags/data><div class=tag-dot style=background-color:#ffe0b2></div>Data</a></li><li><a class=list-tag-item href=/knowledge-base/tags/data-structures><div class=tag-dot style=background-color:#ffcdd2></div>Data structures</a></li><li><a class=list-tag-item href=/knowledge-base/tags/databases><div class=tag-dot style=background-color:#f1f8e9></div>Databases</a></li><li><a class=list-tag-item href=/knowledge-base/tags/dispatcher><div class=tag-dot style=background-color:#c8e6c9></div>Dispatcher</a></li><li><a class=list-tag-item href=/knowledge-base/tags/docker><div class=tag-dot style=background-color:#b9f6ca></div>Docker</a></li><li><a class=list-tag-item href=/knowledge-base/tags/docker-compose><div class=tag-dot style=background-color:#ffe0b2></div>Docker compose</a></li><li><a class=list-tag-item href=/knowledge-base/tags/dotfiles><div class=tag-dot style=background-color:#ab9df2></div>Dotfiles</a></li><li><a class=list-tag-item href=/knowledge-base/tags/editors><div class=tag-dot style=background-color:#ffb74d></div>Editors</a></li><li><a class=list-tag-item href=/knowledge-base/tags/flakes><div class=tag-dot style=background-color:#c8e6c9></div>Flakes</a></li><li><a class=list-tag-item href=/knowledge-base/tags/functional-programming><div class=tag-dot style=background-color:#ffebee></div>Functional programming</a></li><li><a class=list-tag-item href=/knowledge-base/tags/jq><div class=tag-dot style=background-color:#e1f5fe></div>Jq</a></li><li><a class=list-tag-item href=/knowledge-base/tags/json><div class=tag-dot style=background-color:#ffebee></div>JSON</a></li><li><a class=list-tag-item href=/knowledge-base/tags/jvm><div class=tag-dot style=background-color:#90caf9></div>Jvm</a></li><li><a class=list-tag-item href=/knowledge-base/tags/kotlin><div class=tag-dot style=background-color:#ffe57f></div>Kotlin</a></li><li><a class=list-tag-item href=/knowledge-base/tags/lightbend><div class=tag-dot style=background-color:#f0f4c3></div>Lightbend</a></li><li><a class=list-tag-item href=/knowledge-base/tags/monitoring><div class=tag-dot style=background-color:#e3f2fd></div>Monitoring</a></li><li><a class=list-tag-item href=/knowledge-base/tags/nix><div class=tag-dot style=background-color:#c5e1a5></div>Nix</a></li><li><a class=list-tag-item href=/knowledge-base/tags/note><div class=tag-dot style=background-color:#bbdefb></div>Note</a></li><li><a class=list-tag-item href=/knowledge-base/tags/postgres><div class=tag-dot style=background-color:#b2dfdb></div>Postgres</a></li><li><a class=list-tag-item href=/knowledge-base/tags/protocols><div class=tag-dot style=background-color:#ab9df2></div>Protocols</a></li><li><a class=list-tag-item href=/knowledge-base/tags/psql><div class=tag-dot style=background-color:#e0f2f1></div>Psql</a></li><li><a class=list-tag-item href=/knowledge-base/tags/queue><div class=tag-dot style=background-color:#ffebee></div>Queue</a></li><li><a class=list-tag-item href=/knowledge-base/tags/reference><div class=tag-dot style=background-color:#00bfa5></div>Reference</a></li><li><a class=list-tag-item href=/knowledge-base/tags/router><div class=tag-dot style=background-color:#c8e6c9></div>Router</a></li><li><a class=list-tag-item href=/knowledge-base/tags/scala><div class=tag-dot style=background-color:#ffd180></div>Scala</a></li><li><a class=list-tag-item href=/knowledge-base/tags/security><div class=tag-dot style=background-color:#b3e5fc></div>Security</a></li><li><a class=list-tag-item href=/knowledge-base/tags/signing><div class=tag-dot style=background-color:#ffd866></div>Signing</a></li><li><a class=list-tag-item href=/knowledge-base/tags/snippets><div class=tag-dot style=background-color:#e1f5fe></div>Snippets</a></li><li><a class=list-tag-item href=/knowledge-base/tags/stream><div class=tag-dot style=background-color:#d1c4e9></div>Stream</a></li><li><a class=list-tag-item href=/knowledge-base/tags/system-design><div class=tag-dot style=background-color:#ffebee></div>System design</a></li><li><a class=list-tag-item href=/knowledge-base/tags/work><div class=tag-dot style=background-color:#f5f5f5></div>Work</a></li><li><a class=list-tag-item href=/knowledge-base/tags/zettelkasten><div class=tag-dot style=background-color:#e3f2fd></div>Zettelkasten</a></li></ul></nav></div></aside><div class=page><header class=mobile-navigation-header><div class="flex align-center justify-between"><label for=site-menu-control><img src=/knowledge-base/svg/menu-page.svg class=icon alt="Page Menu"></label>
<strong>Microservices</strong>
<label for=content-menu-control><img src=/knowledge-base/svg/menu-content.svg class=icon alt="Content Menu"></label></div></header><article class=markdown><h1 class=post-title><a href=/knowledge-base/notes/microservices/>Microservices</a></h1><p>Subset of Service Oriented Architecture (SOA) where each service is deployed separately:</p><ul><li>Microservices can be physically separated and independently deployed.</li><li>Each have its own data store.</li><li>Independent and self governing.</li><li>Communication is syncronous or asyncronous (e.g., through messaging systems).</li><li>Loose coupling between components (more or less by experience but that is design flaw likely :thinking:).</li><li>Shorter development and release cycles.</li><li>Each scale independently (either through physical or virtual machines).</li></ul><h2 id=advantages>Advantages
<a class=anchor href=#advantages>#</a></h2><ul><li>Deployed/Scaled as needed.</li><li>Increase availability due to reduced single point of failures.</li><li>Better isolation leading to less couling giving flexibility.</li><li>Supports multiple platforms and languages.</li><li>More indepentent</li><li>Shorter cycles</li></ul><p>Mention that cross team coordination become less necessary. That is true but often it still is and requires coordination.</p><h2 id=disavantages>Disavantages
<a class=anchor href=#disavantages>#</a></h2><ul><li>Require multiple complex deployment nad monitoring approaches.</li><li>Cross service refactors are more challenging.</li><li>Require supporting old versions.</li><li>Organization Change</li></ul><h2 id=designing-one>Designing one
<a class=anchor href=#designing-one>#</a></h2><p>Business domains are typically large and complicated. Several ideas, actions and rules interact with one another in complex ways. A good approach on understanding such complex systems and how to model them is through a process named <a href=/knowledge-base/notes/domain_driven_design/>Domain Driven Design</a>
.</p><p>A correct separation of concerns (i.e., clear and single responsibilities) leads to smoother workflows. Awkarwdness when modelling may indicate lack of understanding of the domain.</p><h2 id=principles-of-isolation>Principles of Isolation
<a class=anchor href=#principles-of-isolation>#</a></h2><h3 id=state>State
<a class=anchor href=#state>#</a></h3><p>All access must go thorugh the API and there is no backdoors. Allows internal changes without affecting others.</p><h3 id=space>Space
<a class=anchor href=#space>#</a></h3><p>Should not care where the other services are deployed. Allows microservices to be scaled up or down to meet demands. However, if latency is an issue, they should be in the same region.</p><h3 id=time>Time
<a class=anchor href=#time>#</a></h3><p>Should not wait for each other which allows more efficient use of resources. Resources can be freed immediatly, rather than waiting for a request to finish.</p><p>Between microservices we expect eventual consistency. It improves scalability as total consitency requires central coordination which hindes scalability.</p><p>NOTE: This is discussible. However it may be a implementation details.</p><h3 id=failure>Failure
<a class=anchor href=#failure>#</a></h3><p>Isolate failures and should not cause failure on other systems. I.e., it still is responsive to attend other use-cases.</p><h2 id=isolation-techniques>Isolation Techniques
<a class=anchor href=#isolation-techniques>#</a></h2><h3 id=bulkheading>Bulkheading
<a class=anchor href=#bulkheading>#</a></h3><p>Failures are isolated to failure zones. Failures in one service will not propagate to other services. Overall the system remains operation but possibly in a degraded state.</p><p>In practice it means that that systems that depend on the service that is considered a failure zone, will mark that information or service as unavailable. IMO this is tolerable if the service is non-critical.</p><h3 id=circuit-breaker>Circuit Breaker
<a class=anchor href=#circuit-breaker>#</a></h3><p>When a service is under stress we do not want to keep on retrying as it may make things worse.</p><p>Way to avoid overloading a service. They qaurantine a failing service so it can <em>fail fast</em>. Allows the failing service to recover in its time before they fail.</p><p>Types:</p><ul><li>Closed - Normal Operation</li><li>Open - Fail fast</li><li>Half Open - Internally after a timeout will let one request to go through and if it fails, it goes back to Open.</li></ul><p>Transitions:</p><ul><li>Closed (normal) -> Trip: Open (Fail Fast)</li><li>Open (Fail fast) -> Attempt Reset: Half Open</li><li>Half Open -> Trip: Open (fail Fast)</li><li>Half Open -> Reset: Closed (Normal)</li></ul><h3 id=message-driven-architecture>Message Driven Architecture
<a class=anchor href=#message-driven-architecture>#</a></h3><ul><li>Async and non blocking messages allows decoupling both time and failure.</li><li>System do not depend on the response from on another.</li><li>If a request to a service fails, the failure will not propagated.</li><li>The client service isn&rsquo;t waiting for response. It can continue to operate normally.</li></ul><h3 id=autonomy>Autonomy
<a class=anchor href=#autonomy>#</a></h3><p>Services can operate independently from each other.</p><p>Autonomous services have enough information to resolve conflicts and repair failures. This means that they do not require other services to be operational all the time. Ideally all the time but in reality for a short time it guarantees some level of autonomy.</p><p>Benefits:</p><ul><li>Stronger scalability and availability.</li><li>Can be scaled indefinetly.</li><li>Operate independently.</li></ul><p>How:</p><ul><li>Async messages.</li><li>Maintain enough internal state ofr the microservices to function in isolation.</li><li>Use eventual consistency.</li><li>Avoid direct, syncronous dependencies on external services.</li></ul><h3 id=api-gateway-services>API Gateway Services
<a class=anchor href=#api-gateway-services>#</a></h3><p>Microservices can lead to complexity in the API. How can we manage complex APIs that access many microservices?</p><p>A new microservice that is put between the client and the N-services that are required to fulfill that request. This new microservice is responsible for aggregating the responses moving the responsbility from the client itself. This way, the client <strong>only</strong> needs to manage failures from the gateway.</p><p>This effectively creates an additional layer of isolation.</p><p>!! This is specially useful for mobile applicatios where we cannot guarantee that the clients will update their app.</p></article><footer class=page-footer></footer><label for=site-menu-control class="hidden site-menu-overlay"></label><label for=content-menu-control class="hidden content-menu-overlay"></label></div><aside class=content-menu><div class=content-menu-content><div class=toc-tags><p class=toc-title>Tags</p><div class=list-item-tag style=background-color:#ffebee>System design</div></div><p class=toc-title>Table Of Contents</p><nav id=TableOfContents><ul><li><a href=#advantages>Advantages</a></li><li><a href=#disavantages>Disavantages</a></li><li><a href=#designing-one>Designing one</a></li><li><a href=#principles-of-isolation>Principles of Isolation</a><ul><li><a href=#state>State</a></li><li><a href=#space>Space</a></li><li><a href=#time>Time</a></li><li><a href=#failure>Failure</a></li></ul></li><li><a href=#isolation-techniques>Isolation Techniques</a><ul><li><a href=#bulkheading>Bulkheading</a></li><li><a href=#circuit-breaker>Circuit Breaker</a></li><li><a href=#message-driven-architecture>Message Driven Architecture</a></li><li><a href=#autonomy>Autonomy</a></li><li><a href=#api-gateway-services>API Gateway Services</a></li></ul></li></ul></nav><nav class=backlinks><p class=toc-title>Mentioned In</p><ul class=item-preview-list><li><a href=/knowledge-base/notes/base_transaction/><div class=item-preview><span class=item-preview-title>BASE Transaction</span><br><span class=item-preview-content>Sometimes ACID transactions are not possible in some cases, e.g., microservices. As â€¦</span></div></a></li><li><a href=/knowledge-base/notes/command_query_responsibility_segregation/><div class=item-preview><span class=item-preview-title>Command Query Responsibility Segregation (CQRS)</span><br><span class=item-preview-content>Command Query Responsibility Segregation (CQRS) is a architectural pattern that aims to â€¦</span></div></a></li><li><a href=/knowledge-base/notes/consistency_and_availability/><div class=item-preview><span class=item-preview-title>Consistency And Availability</span><br><span class=item-preview-content>Scalability # It can meets increases in demand while remaining responsive.
This is â€¦</span></div></a></li><li><a href=/knowledge-base/notes/domain_driven_design/><div class=item-preview><span class=item-preview-title>Domain Driven Design</span><br><span class=item-preview-content>Approach on Software Development focused on the design of a shared Model understood by â€¦</span></div></a></li><li><a href=/knowledge-base/notes/message_driven_architecture/><div class=item-preview><span class=item-preview-title>Message Driven Architecture</span><br><span class=item-preview-content>Asyncronous and non-blocking. The sender does not actively wait for a response. â€¦</span></div></a></li></ul></nav></div></aside></main></body></html>
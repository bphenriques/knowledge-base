<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Jackson is a library to serialize and deserialize JSON in the JVM world.
Sane Settings #  After working a while with this I want to register these sane defaults:
configure(DeserializationFeature.FAIL_ON_NULL_FOR_PRIMITIVES, true) configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false) FAIL_ON_NULL_FOR_PRIMITIVES #  Setting FAIL_ON_NULL_FOR_PRIMITIVES forces clients to explicitely provide all values including primitives. Consider the following POJO:
data class Foo(bar: Boolean) Without the setting, a payload such as { } would render ~Foo(bar=false)~ despite the lack of default value."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Jackson"><meta property="og:description" content="Jackson is a library to serialize and deserialize JSON in the JVM world.
Sane Settings #  After working a while with this I want to register these sane defaults:
configure(DeserializationFeature.FAIL_ON_NULL_FOR_PRIMITIVES, true) configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false) FAIL_ON_NULL_FOR_PRIMITIVES #  Setting FAIL_ON_NULL_FOR_PRIMITIVES forces clients to explicitely provide all values including primitives. Consider the following POJO:
data class Foo(bar: Boolean) Without the setting, a payload such as { } would render ~Foo(bar=false)~ despite the lack of default value."><meta property="og:type" content="article"><meta property="og:url" content="https://bphenriques.github.io/knowledge-base/notes/jackson/"><meta property="article:section" content="notes"><title>Jackson | Bruno Henriques's Digital Garden ðŸŒ±</title><link rel=icon href=/knowledge-base/favicon.png type=image/x-icon><link rel=stylesheet href=/knowledge-base/scss/explorer.min.fff1aaee6fb1e5a74069ac1205647344fa7bf178f7f20b3abcf095b18d0c24fe.css integrity="sha256-//Gq7m+x5adAaawSBWRzRPp78Xj38gs6vPCVsY0MJP4=" crossorigin=anonymous><script defer src=/knowledge-base/js/vendor/flexsearch.bundle.js></script><script defer src=/knowledge-base/js/search.min.b6afd1c02733047b79f4611cc21b2dba445fb8844a6ca9d4e3d3eca6da9c378a.js integrity="sha256-tq/RwCczBHt59GEcwhstukRfuIRKbKnU49PsptqcN4o=" crossorigin=anonymous></script><script defer src=/knowledge-base/js/clipboard.min.14b9ccf5803971502776b44d95026b084e5fa02a544dc0e4cd86a7db76f691b2.js integrity="sha256-FLnM9YA5cVAndrRNlQJrCE5foCpUTcDkzYan23b2kbI=" crossorigin=anonymous></script></head><body><input type=checkbox class="hidden toggle" id=site-menu-control>
<input type=checkbox class="hidden toggle" id=content-menu-control><main class="container flex"><aside class=site-menu><div class=site-menu-content><nav><h2 class=brand><a class="flex align-center" href=/knowledge-base/><span>Bruno Henriques</span></a></h2><div class=search><input type=text id=search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="search-spinner hidden"></div><ul id=search-results class=item-preview-list></ul></div><a class=site-menu-shortcut-link href=/knowledge-base/notes>Recent Notes</a><p class=site-menu-tags-title><b>Tags</b></p><ul><li><a class=list-tag-item href=/knowledge-base/tags/akka><div class=tag-dot style=background-color:#ffecb3></div>Akka</a></li><li><a class=list-tag-item href=/knowledge-base/tags/concurrency><div class=tag-dot style=background-color:#f5f5f5></div>Concurrency</a></li><li><a class=list-tag-item href=/knowledge-base/tags/data><div class=tag-dot style=background-color:#ffe0b2></div>Data</a></li><li><a class=list-tag-item href=/knowledge-base/tags/data-structures><div class=tag-dot style=background-color:#ffcdd2></div>Data structures</a></li><li><a class=list-tag-item href=/knowledge-base/tags/databases><div class=tag-dot style=background-color:#f1f8e9></div>Databases</a></li><li><a class=list-tag-item href=/knowledge-base/tags/dispatcher><div class=tag-dot style=background-color:#c8e6c9></div>Dispatcher</a></li><li><a class=list-tag-item href=/knowledge-base/tags/docker><div class=tag-dot style=background-color:#b9f6ca></div>Docker</a></li><li><a class=list-tag-item href=/knowledge-base/tags/docker-compose><div class=tag-dot style=background-color:#ffe0b2></div>Docker compose</a></li><li><a class=list-tag-item href=/knowledge-base/tags/dotfiles><div class=tag-dot style=background-color:#ab9df2></div>Dotfiles</a></li><li><a class=list-tag-item href=/knowledge-base/tags/editors><div class=tag-dot style=background-color:#ffb74d></div>Editors</a></li><li><a class=list-tag-item href=/knowledge-base/tags/flakes><div class=tag-dot style=background-color:#c8e6c9></div>Flakes</a></li><li><a class=list-tag-item href=/knowledge-base/tags/functional-programming><div class=tag-dot style=background-color:#ffebee></div>Functional programming</a></li><li><a class=list-tag-item href=/knowledge-base/tags/jq><div class=tag-dot style=background-color:#e1f5fe></div>Jq</a></li><li><a class=list-tag-item href=/knowledge-base/tags/json><div class=tag-dot style=background-color:#ffebee></div>JSON</a></li><li><a class=list-tag-item href=/knowledge-base/tags/jvm><div class=tag-dot style=background-color:#90caf9></div>Jvm</a></li><li><a class=list-tag-item href=/knowledge-base/tags/kotlin><div class=tag-dot style=background-color:#ffe57f></div>Kotlin</a></li><li><a class=list-tag-item href=/knowledge-base/tags/lightbend><div class=tag-dot style=background-color:#f0f4c3></div>Lightbend</a></li><li><a class=list-tag-item href=/knowledge-base/tags/monitoring><div class=tag-dot style=background-color:#e3f2fd></div>Monitoring</a></li><li><a class=list-tag-item href=/knowledge-base/tags/nix><div class=tag-dot style=background-color:#c5e1a5></div>Nix</a></li><li><a class=list-tag-item href=/knowledge-base/tags/note><div class=tag-dot style=background-color:#bbdefb></div>Note</a></li><li><a class=list-tag-item href=/knowledge-base/tags/postgres><div class=tag-dot style=background-color:#b2dfdb></div>Postgres</a></li><li><a class=list-tag-item href=/knowledge-base/tags/protocols><div class=tag-dot style=background-color:#ab9df2></div>Protocols</a></li><li><a class=list-tag-item href=/knowledge-base/tags/psql><div class=tag-dot style=background-color:#e0f2f1></div>Psql</a></li><li><a class=list-tag-item href=/knowledge-base/tags/queue><div class=tag-dot style=background-color:#ffebee></div>Queue</a></li><li><a class=list-tag-item href=/knowledge-base/tags/reference><div class=tag-dot style=background-color:#00bfa5></div>Reference</a></li><li><a class=list-tag-item href=/knowledge-base/tags/router><div class=tag-dot style=background-color:#c8e6c9></div>Router</a></li><li><a class=list-tag-item href=/knowledge-base/tags/scala><div class=tag-dot style=background-color:#ffd180></div>Scala</a></li><li><a class=list-tag-item href=/knowledge-base/tags/security><div class=tag-dot style=background-color:#b3e5fc></div>Security</a></li><li><a class=list-tag-item href=/knowledge-base/tags/signing><div class=tag-dot style=background-color:#ffd866></div>Signing</a></li><li><a class=list-tag-item href=/knowledge-base/tags/snippets><div class=tag-dot style=background-color:#e1f5fe></div>Snippets</a></li><li><a class=list-tag-item href=/knowledge-base/tags/stream><div class=tag-dot style=background-color:#d1c4e9></div>Stream</a></li><li><a class=list-tag-item href=/knowledge-base/tags/system-design><div class=tag-dot style=background-color:#ffebee></div>System design</a></li><li><a class=list-tag-item href=/knowledge-base/tags/work><div class=tag-dot style=background-color:#f5f5f5></div>Work</a></li><li><a class=list-tag-item href=/knowledge-base/tags/zettelkasten><div class=tag-dot style=background-color:#e3f2fd></div>Zettelkasten</a></li></ul></nav></div></aside><div class=page><header class=mobile-navigation-header><div class="flex align-center justify-between"><label for=site-menu-control><img src=/knowledge-base/svg/menu-page.svg class=icon alt="Page Menu"></label>
<strong>Jackson</strong>
<label for=content-menu-control><img src=/knowledge-base/svg/menu-content.svg class=icon alt="Content Menu"></label></div></header><article class=markdown><h1 class=post-title><a href=/knowledge-base/notes/jackson/>Jackson</a></h1><p>Jackson is a library to serialize and deserialize JSON in the JVM world.</p><h2 id=sane-settings>Sane Settings
<a class=anchor href=#sane-settings>#</a></h2><p>After working a while with this I want to register these sane defaults:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>configure(DeserializationFeature.FAIL_ON_NULL_FOR_PRIMITIVES, <span style=color:#66d9ef>true</span>)
configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, <span style=color:#66d9ef>false</span>)
</code></pre></div><h3 id=fail-on-null-for-primitives><code>FAIL_ON_NULL_FOR_PRIMITIVES</code>
<a class=anchor href=#fail-on-null-for-primitives>#</a></h3><p>Setting <code>FAIL_ON_NULL_FOR_PRIMITIVES</code> forces clients to explicitely provide all values including primitives. Consider the following POJO:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Foo</span>(bar: Boolean)
</code></pre></div><p>Without the setting, a payload such as <code>{ }</code> would render <code>~Foo(bar=false)~</code> despite the lack of default value. Given this, to guarantee consistency between the source-code and the external contract, I advise enabling this.</p><h3 id=fail-on-unknown-properties><code>FAIL_ON_UNKNOWN_PROPERTIES</code>
<a class=anchor href=#fail-on-unknown-properties>#</a></h3><p>Setting <code>FAIL_ON_UNKNOWN_PROPERTIES</code> is useful when working on two systems in paralel. Settings this to <code>false</code> enables clients to send fields to the server that are not yet supported but will be. The alternative would be:</p><ol><li>Server includes those fields as <strong>optional</strong> fields (to avoid breaking current clients).</li><li>Server roll-out.</li><li>Clients update their HTTP clients to include the new fields.</li><li>Once all-known clients support the new fields, make the same fields mandatory.</li></ol><p>By setting this to <code>true</code>, this whole orchestration is not required.</p><h2 id=sub-types><span class="org-todo todo TODO">TODO</span> Sub-Types
<a class=anchor href=#sub-types>#</a></h2><p>Consider the following example that attempts to model a DSL that supports <code>+</code> and <code>-</code> operations.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Expression</span>
<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Sum</span>(<span style=color:#66d9ef>val</span> a: Int, <span style=color:#66d9ef>val</span> b: Int): Expression()
<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Sub</span>(<span style=color:#66d9ef>val</span> a: Int, <span style=color:#66d9ef>val</span> b: Int): Expression()

<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Request</span>(
    <span style=color:#a6e22e>@JsonTypeInfo</span>(use = JsonTypeInfo.Id.NAME, include = JsonTypeInfo.As.EXTERNAL_PROPERTY, <span style=color:#66d9ef>property</span> = <span style=color:#e6db74>&#34;type&#34;</span>, visible = <span style=color:#66d9ef>true</span>)
    <span style=color:#a6e22e>@JsonSubTypes</span>(
	JsonSubTypes.Type(value = Sum<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>, name = <span style=color:#e6db74>&#34;+&#34;</span>)
	JsonSubTypes.Type(value = Sub<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>, name = <span style=color:#e6db74>&#34;-&#34;</span>)
    )
    <span style=color:#66d9ef>val</span> operation: Expression
)
</code></pre></div><p>In short, this is saying if the JSON contains a field name <code>type</code> with value <code>+</code> it would deserialize to <code>Sum</code> and to <code>Sub</code> if <code>type</code> had value <code>-</code>. I.e., a sum operation between 1 and 2 would require the following JSON payload:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;+&#34;</span>,
    <span style=color:#f92672>&#34;operation&#34;</span>: {
	 <span style=color:#f92672>&#34;a&#34;</span>: <span style=color:#ae81ff>1</span>,
	 <span style=color:#f92672>&#34;b&#34;</span>: <span style=color:#ae81ff>2</span>
    }
}
</code></pre></div></article><footer class=page-footer></footer><label for=site-menu-control class="hidden site-menu-overlay"></label><label for=content-menu-control class="hidden content-menu-overlay"></label></div><aside class=content-menu><div class=content-menu-content><div class=toc-tags><p class=toc-title>Tags</p><div class=list-item-tag style=background-color:#90caf9>Jvm</div><div class=list-item-tag style=background-color:#ffebee>JSON</div></div><p class=toc-title>Table Of Contents</p><nav id=TableOfContents><ul><li><a href=#sane-settings>Sane Settings</a><ul><li><a href=#fail-on-null-for-primitives><code>FAIL_ON_NULL_FOR_PRIMITIVES</code></a></li><li><a href=#fail-on-unknown-properties><code>FAIL_ON_UNKNOWN_PROPERTIES</code></a></li></ul></li><li><a href=#sub-types><span class="org-todo todo TODO">TODO</span> Sub-Types</a></li></ul></nav></div></aside></main></body></html>
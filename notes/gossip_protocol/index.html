<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Some of these text may be interwined with specifities of the Gossip Protocol within Akka Cluster .
Context: TODO
At a regular interval, each member sends their view of the cluster state to a random node, including:
 The status of each member If each member has seen this version of the cluster state.  Eventually consistent as after some time (aka convergence), all nodes will share the same state. Each node decides if it has reached convergence."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Gossip Protocol"><meta property="og:description" content="Some of these text may be interwined with specifities of the Gossip Protocol within Akka Cluster .
Context: TODO
At a regular interval, each member sends their view of the cluster state to a random node, including:
 The status of each member If each member has seen this version of the cluster state.  Eventually consistent as after some time (aka convergence), all nodes will share the same state. Each node decides if it has reached convergence."><meta property="og:type" content="article"><meta property="og:url" content="https://bphenriques.github.io/knowledge-base/notes/gossip_protocol/"><meta property="article:section" content="notes"><title>Gossip Protocol | Bruno Henriques's Digital Garden ðŸŒ±</title><link rel=icon href=/knowledge-base/favicon.png type=image/x-icon><link rel=stylesheet href=/knowledge-base/scss/explorer.min.567717050ac2a9fa772b17e11a0a1e0f19c73dc0772ac29530c27ddb3558efb2.css integrity="sha256-VncXBQrCqfp3KxfhGgoeDxnHPcB3KsKVMMJ92zVY77I=" crossorigin=anonymous><script defer src=/knowledge-base/js/vendor/flexsearch.bundle.js></script><script defer src=/knowledge-base/js/search.min.09bdd303a3362f89a96ee1f09ddaa157fb892068e470819be0cd608873d8e50c.js integrity="sha256-Cb3TA6M2L4mpbuHwndqhV/uJIGjkcIGb4M1giHPY5Qw=" crossorigin=anonymous></script><script defer src=/knowledge-base/js/clipboard.min.14b9ccf5803971502776b44d95026b084e5fa02a544dc0e4cd86a7db76f691b2.js integrity="sha256-FLnM9YA5cVAndrRNlQJrCE5foCpUTcDkzYan23b2kbI=" crossorigin=anonymous></script></head><body><input type=checkbox class="hidden toggle" id=site-menu-control>
<input type=checkbox class="hidden toggle" id=content-menu-control><main class="container flex"><aside class=site-menu><div class=site-menu-content><nav><h2 class=brand><a class="flex align-center" href=/knowledge-base/><span>Bruno Henriques</span></a></h2><div class=search><input type=text id=search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="search-spinner hidden"></div><ul id=search-results class=item-preview-list></ul></div><a class=site-menu-shortcut-link href=/knowledge-base/notes>Recent Notes</a><p class=site-menu-tags-title><b>Tags</b></p><ul><li><a class=list-tag-item href=/knowledge-base/tags/akka><div class=tag-dot style=background-color:#ffecb3></div>Akka</a></li><li><a class=list-tag-item href=/knowledge-base/tags/concurrency><div class=tag-dot style=background-color:#f5f5f5></div>Concurrency</a></li><li><a class=list-tag-item href=/knowledge-base/tags/data><div class=tag-dot style=background-color:#ffe0b2></div>Data</a></li><li><a class=list-tag-item href=/knowledge-base/tags/data-structures><div class=tag-dot style=background-color:#ffcdd2></div>Data structures</a></li><li><a class=list-tag-item href=/knowledge-base/tags/databases><div class=tag-dot style=background-color:#f1f8e9></div>Databases</a></li><li><a class=list-tag-item href=/knowledge-base/tags/dispatcher><div class=tag-dot style=background-color:#c8e6c9></div>Dispatcher</a></li><li><a class=list-tag-item href=/knowledge-base/tags/editors><div class=tag-dot style=background-color:#ffb74d></div>Editors</a></li><li><a class=list-tag-item href=/knowledge-base/tags/jq><div class=tag-dot style=background-color:#e1f5fe></div>Jq</a></li><li><a class=list-tag-item href=/knowledge-base/tags/json><div class=tag-dot style=background-color:#ffebee></div>JSON</a></li><li><a class=list-tag-item href=/knowledge-base/tags/jvm><div class=tag-dot style=background-color:#90caf9></div>Jvm</a></li><li><a class=list-tag-item href=/knowledge-base/tags/kotlin><div class=tag-dot style=background-color:#ffe57f></div>Kotlin</a></li><li><a class=list-tag-item href=/knowledge-base/tags/lightbend><div class=tag-dot style=background-color:#f0f4c3></div>Lightbend</a></li><li><a class=list-tag-item href=/knowledge-base/tags/monitoring><div class=tag-dot style=background-color:#e3f2fd></div>Monitoring</a></li><li><a class=list-tag-item href=/knowledge-base/tags/note><div class=tag-dot style=background-color:#bbdefb></div>Note</a></li><li><a class=list-tag-item href=/knowledge-base/tags/protocols><div class=tag-dot style=background-color:#ab9df2></div>Protocols</a></li><li><a class=list-tag-item href=/knowledge-base/tags/psql><div class=tag-dot style=background-color:#e0f2f1></div>Psql</a></li><li><a class=list-tag-item href=/knowledge-base/tags/queue><div class=tag-dot style=background-color:#ffebee></div>Queue</a></li><li><a class=list-tag-item href=/knowledge-base/tags/reference><div class=tag-dot style=background-color:#00bfa5></div>Reference</a></li><li><a class=list-tag-item href=/knowledge-base/tags/router><div class=tag-dot style=background-color:#c8e6c9></div>Router</a></li><li><a class=list-tag-item href=/knowledge-base/tags/scala><div class=tag-dot style=background-color:#ffd180></div>Scala</a></li><li><a class=list-tag-item href=/knowledge-base/tags/security><div class=tag-dot style=background-color:#b3e5fc></div>Security</a></li><li><a class=list-tag-item href=/knowledge-base/tags/signing><div class=tag-dot style=background-color:#ffd866></div>Signing</a></li><li><a class=list-tag-item href=/knowledge-base/tags/snippets><div class=tag-dot style=background-color:#e1f5fe></div>Snippets</a></li><li><a class=list-tag-item href=/knowledge-base/tags/stream><div class=tag-dot style=background-color:#d1c4e9></div>Stream</a></li><li><a class=list-tag-item href=/knowledge-base/tags/system-design><div class=tag-dot style=background-color:#ffebee></div>System design</a></li><li><a class=list-tag-item href=/knowledge-base/tags/uncategorized><div class=tag-dot style=background-color:#90caf9></div>Uncategorized</a></li><li><a class=list-tag-item href=/knowledge-base/tags/work><div class=tag-dot style=background-color:#f5f5f5></div>Work</a></li><li><a class=list-tag-item href=/knowledge-base/tags/zettelkasten><div class=tag-dot style=background-color:#e3f2fd></div>Zettelkasten</a></li></ul></nav></div></aside><div class=page><header class=mobile-navigation-header><div class="flex align-center justify-between"><label for=site-menu-control><img src=/knowledge-base/svg/menu-page.svg class=icon alt="Page Menu"></label>
<strong>Gossip Protocol</strong>
<label for=content-menu-control><img src=/knowledge-base/svg/menu-content.svg class=icon alt="Content Menu"></label></div></header><article class=markdown><h1 class=post-title><a href=/knowledge-base/notes/gossip_protocol/>Gossip Protocol</a></h1><p>Some of these text may be interwined with specifities of the Gossip Protocol within <a href=/knowledge-base/notes/akka_cluster/>Akka Cluster</a>
.</p><p>Context: TODO</p><p>At a regular interval, each member sends their view of the cluster state to a random node, including:</p><ul><li>The status of each member</li><li>If each member has seen this version of the cluster state.</li></ul><p>Eventually consistent as after some time (aka <code>convergence</code>), all nodes will share the same state. Each node decides if it has reached convergence.</p><p>After it, each node will have the same ordered set of nodes:</p><ul><li>Node 1</li><li>Node 2</li><li>Node 3</li></ul><p>Then the first eligible node, will become the leader and will perform leader&rsquo;s duties such as notify member state changes</p><p>Note: that each leader may change after each round if the cluster membership has changed.</p><h2 id=member-lifecycle-happy-path>Member Lifecycle - Happy Path
<a class=anchor href=#member-lifecycle-happy-path>#</a></h2><pre><code class=language-nil data-lang=nil>Joining -&gt; Up -&gt; Leaving -&gt; Exiting -&gt; Removed (tombstoned)
</code></pre><p>In this case:</p><ul><li>Once all nodes know that all nodes know that a new node is &ldquo;Joining&rdquo;, it marks it as &ldquo;Up&rdquo;.</li><li>A leaving node sets itself as <code>Leaving</code>, then once all nodes know it, the leader marks it as <code>Exiting</code>.</li><li>Once all leaders know that a node is <code>Exiting</code>, the leader sets the node as <code>Removed</code>.</li></ul><h2 id=member-lifecycle-unhappy-path>Member Lifecycle - Unhappy Path
<a class=anchor href=#member-lifecycle-unhappy-path>#</a></h2><pre><code class=language-nil data-lang=nil>Joining -&gt; Up -&gt; Leaving -&gt; Exiting -&gt; Removed (tombstoned)
  |        |        |          |         /|\
  |--disconnected--------------|          |
 \|/                                      |
Unreachable (F) ----&gt; Down (F) ------------
</code></pre><p>When a new member is disconnected, it is marked as Unreachable until it recovers. If it is permanent, it is flagged as Down and it moves to state Removed and can never come back.</p><p>Each node is monitored for failures by at most 5 nodes using <a href=/knowledge-base/notes/heartbeat/>Heartbeat</a>
. Once a member is deemed unreachable, then than information will be gossiped to the cluster. The member will remain like that until all nodes flag the node as <code>Reachabe</code> again.</p><p>Reasons:</p><ul><li>Crashes</li><li>Heavy load</li><li>Network Partition or failure</li></ul><h3 id=impact-of-unreachable-nodes>Impact of Unreachable Nodes
<a class=anchor href=#impact-of-unreachable-nodes>#</a></h3><p><strong>Convergence will not be possible</strong> therefore no leaders will be elected therefore new nodes cannot fully join the cluster. This will happen until the node is marked as <code>Down</code> (and then <code>Removed</code>).</p><p>In this moment, potential new members will have a state <code>WeaklyUpMember</code>, which can transition to <code>Up</code> once convergence is complete. Note that, this member can be used by applications but <strong>should not</strong> if consistency is important (Cluster Shards or Cluster Singletons).</p><h2 id=todo>TODO
<a class=anchor href=#todo>#</a></h2><ul><li>Check if Heartbeat and Gossip Protocol are <em>always</em> interwined.</li></ul></article><footer class=page-footer></footer><label for=site-menu-control class="hidden site-menu-overlay"></label><label for=content-menu-control class="hidden content-menu-overlay"></label></div><aside class=content-menu><div class=content-menu-content><div class=toc-tags><p class=toc-title>Tags</p><div class=list-item-tag style=background-color:#ab9df2>Protocols</div></div><p class=toc-title>Table Of Contents</p><nav id=TableOfContents><ul><li><a href=#member-lifecycle-happy-path>Member Lifecycle - Happy Path</a></li><li><a href=#member-lifecycle-unhappy-path>Member Lifecycle - Unhappy Path</a><ul><li><a href=#impact-of-unreachable-nodes>Impact of Unreachable Nodes</a></li></ul></li><li><a href=#todo>TODO</a></li></ul></nav><nav class=backlinks><p class=toc-title>Mentioned In</p><ul class=item-preview-list><li><a href=/knowledge-base/notes/akka_cluster/><div class=item-preview><span class=item-preview-title>Akka Cluster</span><br><span class=item-preview-content>Akka Cluster # Scenario: Make actors communicate across the network.
Allows actors to â€¦</span></div></a></li></ul></nav></div></aside></main></body></html>
{{- $pages := .Site.Pages -}}
{{- $nodes := slice -}}
{{- $edges := slice -}}
{{- range $current := $pages -}}
  {{- range $neighbour := $pages -}}
    {{- if and (findRE $current.Title $neighbour.RawContent) (not (eq $current.Title $neighbour.Title)) -}}
      {{- $edges = $edges | append (printf "{ \"source\":%s,\"target\":%s}" ($current.Title | jsonify) ($neighbour.Title | jsonify)) -}}
    {{- end -}}
  {{- end -}}

  {{- $nodes = $nodes | append (printf "{ \"id\":%s,\"path\":%s,\"label\":%s}" ($current.Title | jsonify) ($current.RelPermalink | jsonify) ($current.Title | jsonify) ) -}}
{{- end -}}
{
   "nodes": [
     {{- range $index, $node := $nodes -}}
     {{- if gt $index 0 }},{{end}} {{ $node }}
     {{- end -}}
   ],
   "edges": [
     {{- range $index, $edge := $edges -}}
     {{- if gt $index 0 }},{{end}} {{ $edge }}
     {{- end -}}
   ]
}



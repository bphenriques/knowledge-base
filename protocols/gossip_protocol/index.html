<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Some of these text may be interwined with specifities of the Gossip Protocol within Akka.
Context: TODO
At a regular interval, each member sends their view of the cluster state to a random node, including:
 The status of each member If each member has seen this version of the cluster state.  Eventually consistent as after some time (aka convergence), all nodes will share the same state. Each node decides if it has reached convergence."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Gossip Protocol"><meta property="og:description" content="Some of these text may be interwined with specifities of the Gossip Protocol within Akka.
Context: TODO
At a regular interval, each member sends their view of the cluster state to a random node, including:
 The status of each member If each member has seen this version of the cluster state.  Eventually consistent as after some time (aka convergence), all nodes will share the same state. Each node decides if it has reached convergence."><meta property="og:type" content="article"><meta property="og:url" content="https://bphenriques.github.io/knowledge-base/protocols/gossip_protocol/"><title>Gossip Protocol | Bruno Henriques</title><link rel=manifest href=https://bphenriques.github.io/knowledge-base/manifest.json><link rel=icon href=https://bphenriques.github.io/knowledge-base/favicon.png type=image/x-icon><link rel=stylesheet href=https://bphenriques.github.io/knowledge-base/book.min.c8d3866fece0f65580e9d9c5e7411c48781c968eb10c1b128e0521e3a9b441b2.css integrity="sha256-yNOGb+zg9lWA6dnF50EcSHgclo6xDBsSjgUh46m0QbI="><script defer src=https://bphenriques.github.io/knowledge-base/en.search.min.36438b12ef6ec28162a860ad3cb484d8070a6f9c83d145f0a3dc5756aa07b6de.js integrity="sha256-NkOLEu9uwoFiqGCtPLSE2AcKb5yD0UXwo9xXVqoHtt4="></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=https://bphenriques.github.io/knowledge-base/><span>Bruno Henriques</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Akka</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/akka/akka_cluster/>Akka Cluster</a></li><li><a href=https://bphenriques.github.io/knowledge-base/akka/akka_dispatcher/>Akka Dispatcher</a></li><li><a href=https://bphenriques.github.io/knowledge-base/akka/akka_router/>Akka Router</a></li><li><a href=https://bphenriques.github.io/knowledge-base/akka/akka_sharding/>Akka Sharding</a></li><li><a href=https://bphenriques.github.io/knowledge-base/akka/akka_streams/>Akka Streams</a></li><li><a href=https://bphenriques.github.io/knowledge-base/akka/akka_testing/>Akka Testing</a></li></ul></li><li class=book-section-flat><span>Concurrency</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/concurrency/actor-model/>Actor Model</a></li><li><a href=https://bphenriques.github.io/knowledge-base/concurrency/amdah_s_law/>Amdah's Law</a></li><li><a href=https://bphenriques.github.io/knowledge-base/concurrency/gunther_s_universal_scalability_law/>Gunther's Universal Scalability Law</a></li></ul></li><li class=book-section-flat><span>Data Processing</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/data-processing/states-of-data/>States of Data</a></li></ul></li><li class=book-section-flat><span>Databases</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/databases/databases_overview/>Databases Overview</a></li><li><a href=https://bphenriques.github.io/knowledge-base/databases/databases_sharding-or-partitioning/>Sharding or Partitioning</a></li></ul></li><li class=book-section-flat><span>Documentation</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/documentation/readme/>Readme</a></li></ul></li><li class=book-section-flat><span>Editors</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/editors/emacs/>Emacs</a></li></ul></li><li class=book-section-flat><span>Learning</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/learning/coursera/>Coursera</a></li><li><a href=https://bphenriques.github.io/knowledge-base/learning/hands_on_scala_programming/>Hands-on Scala Programming</a></li><li><a href=https://bphenriques.github.io/knowledge-base/learning/technical_writing/>Technical Writing</a></li></ul></li><li class=book-section-flat><span>Messaging Systems</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/messaging-systems/messaging-systems-overview/>Messaging Systems Comparison</a></li></ul></li><li class=book-section-flat><span>Monitoring</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/monitoring/bug-management/>Bug Management</a></li></ul></li><li class=book-section-flat><span>Protocols</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/protocols/gossip_protocol/ class=active>Gossip Protocol</a></li><li><a href=https://bphenriques.github.io/knowledge-base/protocols/heartbeat/>Heartbeat</a></li></ul></li><li class=book-section-flat><span>Resources</span><ul></ul></li><li class=book-section-flat><span>Security</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/security/jwt/>JWT</a></li></ul></li><li class=book-section-flat><span>System Design</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/system-design/command_query_responsibility_segregation/>Command Query Responsibility Segregation (CQRS)</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/command_sourcing/>Command Sourcing</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/consistency_and_availability/>Consistency And Availability</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/domain_driven_design/>Domain Driven Design</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/event_sourcing/>Event Sourcing</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/message_driven_architecture/>Message Driven Architecture</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/microservices/>Microservices</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/monolith/>Monolith</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/reactive_streams/>Reactive Streams</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/reactive_systems/>Reactive Systems</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/service_oriented_architecture_soa/>Service Oriented Architecture (SOA)</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/system-design_sli-slo/>SLI/SLO</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/system-design_stateless/>Stateless</a></li></ul></li><li class=book-section-flat><span>Work</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/work/curriculum/>Curriculum</a></li><li><a href=https://bphenriques.github.io/knowledge-base/work/random-memories/>Random Memories</a></li><li><a href=https://bphenriques.github.io/knowledge-base/work/thinking_tools/>Thinking Tools</a></li><li><a href=https://bphenriques.github.io/knowledge-base/work/way-of-work/>Way of work</a></li></ul></li><li class=book-section-flat><span>Snippets</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/snippets/emacs/>Emacs</a></li><li><a href=https://bphenriques.github.io/knowledge-base/snippets/jackson/>Jackson</a></li></ul></li><li class=book-section-flat><span>Blog Ideas</span><ul></ul></li><li class=book-section-flat><span>Uncategorized</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/uncategorized/akka/>Akka</a></li><li><a href=https://bphenriques.github.io/knowledge-base/uncategorized/dotfiles/>dotfiles</a></li><li><a href=https://bphenriques.github.io/knowledge-base/uncategorized/gpg/>gpg</a></li><li><a href=https://bphenriques.github.io/knowledge-base/uncategorized/nix/>Nix</a></li><li><a href=https://bphenriques.github.io/knowledge-base/uncategorized/relevant-xkcds/>Relevant xkcds</a></li><li><a href=https://bphenriques.github.io/knowledge-base/uncategorized/web-stack-enties/>Stack Web Notes</a></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=https://bphenriques.github.io/knowledge-base/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Gossip Protocol</strong>
<label for=toc-control><img src=https://bphenriques.github.io/knowledge-base/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#member-lifecycle-happy-path>Member Lifecycle - Happy Path</a></li><li><a href=#member-lifecycle-unhappy-path>Member Lifecycle - Unhappy Path</a><ul><li><a href=#impact-of-unreachable-nodes>Impact of Unreachable Nodes</a></li></ul></li><li><a href=#todo>TODO</a></li></ul></nav></aside></header><div class=backlinks><h3>Referred in:</h3><ul><li><a href=https://bphenriques.github.io/knowledge-base/akka/akka_cluster/>Akka Cluster</a></li></ul></div><article class=markdown><p>Some of these text may be interwined with specifities of the Gossip Protocol within <a href=https://bphenriques.github.io/knowledge-base/akka/>Akka</a>.</p><p>Context: TODO</p><p>At a regular interval, each member sends their view of the cluster state to a random node, including:</p><ul><li>The status of each member</li><li>If each member has seen this version of the cluster state.</li></ul><p>Eventually consistent as after some time (aka <code>convergence</code>), all nodes will share the same state. Each node decides if it has reached convergence.</p><p>After it, each node will have the same ordered set of nodes:</p><ul><li>Node 1</li><li>Node 2</li><li>Node 3</li></ul><p>Then the first eligible node, will become the leader and will perform leader&rsquo;s duties such as notify member state changes</p><p>Note: that each leader may change after each round if the cluster membership has changed.</p><h2 id=member-lifecycle-happy-path>Member Lifecycle - Happy Path
<a class=anchor href=#member-lifecycle-happy-path>#</a></h2><pre><code class=language-nil data-lang=nil>Joining -&gt; Up -&gt; Leaving -&gt; Exiting -&gt; Removed (tombstoned)
</code></pre><p>In this case:</p><ul><li>Once all nodes know that all nodes know that a new node is &ldquo;Joining&rdquo;, it marks it as &ldquo;Up&rdquo;.</li><li>A leaving node sets itself as <code>Leaving</code>, then once all nodes know it, the leader marks it as <code>Exiting</code>.</li><li>Once all leaders know that a node is <code>Exiting</code>, the leader sets the node as <code>Removed</code>.</li></ul><h2 id=member-lifecycle-unhappy-path>Member Lifecycle - Unhappy Path
<a class=anchor href=#member-lifecycle-unhappy-path>#</a></h2><pre><code class=language-nil data-lang=nil>Joining -&gt; Up -&gt; Leaving -&gt; Exiting -&gt; Removed (tombstoned)
  |        |        |          |         /|\
  |--disconnected--------------|          |
 \|/                                      |
Unreachable (F) ----&gt; Down (F) ------------
</code></pre><p>When a new member is disconnected, it is marked as Unreachable until it recovers. If it is permanent, it is flagged as Down and it moves to state Removed and can never come back.</p><p>Each node is monitored for failures by at most 5 nodes using <a href=https://bphenriques.github.io/knowledge-base/protocols/heartbeat/>Heartbeat</a>. Once a member is deemed unreachable, then than information will be gossiped to the cluster. The member will remain like that until all nodes flag the node as <code>Reachabe</code> again.</p><p>Reasons:</p><ul><li>Crashes</li><li>Heavy load</li><li>Network Partition or failure</li></ul><h3 id=impact-of-unreachable-nodes>Impact of Unreachable Nodes
<a class=anchor href=#impact-of-unreachable-nodes>#</a></h3><p><strong>Convergence will not be possible</strong> therefore no leaders will be elected therefore new nodes cannot fully join the cluster. This will happen until the node is marked as <code>Down</code> (and then <code>Removed</code>).</p><p>In this moment, potential new members will have a state <code>WeaklyUpMember</code>, which can transition to <code>Up</code> once convergence is complete. Note that, this member can be used by applications but <strong>should not</strong> if consistency is important (Cluster Shards or Cluster Singletons).</p><h2 id=todo>TODO
<a class=anchor href=#todo>#</a></h2><ul><li>Check if Heartbeat and Gossip Protocol are <em>always</em> interwined.</li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><div><a class="flex align-center" href=https://github.com/bphenriques/knowledge-base/edit/master/org/protocols/gossip_protocol.org target=_blank rel=noopener><img src=https://bphenriques.github.io/knowledge-base/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#member-lifecycle-happy-path>Member Lifecycle - Happy Path</a></li><li><a href=#member-lifecycle-unhappy-path>Member Lifecycle - Unhappy Path</a><ul><li><a href=#impact-of-unreachable-nodes>Impact of Unreachable Nodes</a></li></ul></li><li><a href=#todo>TODO</a></li></ul></nav></aside></main></body></html>
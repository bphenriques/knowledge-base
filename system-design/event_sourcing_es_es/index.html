<!doctype html><html lang=en dir=ltr><head><meta name=generator content="Hugo 0.74.3"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Representing the application&rsquo;s state through the history of events that have happened in the past. Use cases:
 Audit Logs: Build tailored reports from the event stream. Analytics: Extract behavior from the event stream. Temporal Reports: Build the timeline that led to a certain state.  This is the opposite of regular applications where the final state is stored. In Event Sourced applications, the final state is called Materialized State. Whenever we need to obtain the current state we replay the logs until we reach the current state without replaying the side-effects."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Event Sourcing (ES)"><meta property="og:description" content="Representing the application&rsquo;s state through the history of events that have happened in the past. Use cases:
 Audit Logs: Build tailored reports from the event stream. Analytics: Extract behavior from the event stream. Temporal Reports: Build the timeline that led to a certain state.  This is the opposite of regular applications where the final state is stored. In Event Sourced applications, the final state is called Materialized State. Whenever we need to obtain the current state we replay the logs until we reach the current state without replaying the side-effects."><meta property="og:type" content="article"><meta property="og:url" content="https://bphenriques.github.io/knowledge-base/system-design/event_sourcing_es_es/"><title>Event Sourcing (ES) | Bruno Henriques</title><link rel=manifest href=https://bphenriques.github.io/knowledge-base/manifest.json><link rel=icon href=https://bphenriques.github.io/knowledge-base/favicon.png type=image/x-icon><link rel=stylesheet href=https://bphenriques.github.io/knowledge-base/book.min.30d3414efaeb1d1ebd7cd338d441a193d2938a6c345cd477aa29b4113001564d.css integrity="sha256-MNNBTvrrHR69fNM41EGhk9KTimw0XNR3qim0ETABVk0="><script defer src=https://bphenriques.github.io/knowledge-base/en.search.min.ae90f4c5d76cf59dc9226361a87e4543e02ebe2e2435cf09129d657e5c07d8b4.js integrity="sha256-rpD0xdds9Z3JImNhqH5FQ+Auvi4kNc8JEp1lflwH2LQ="></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a href=https://bphenriques.github.io/knowledge-base/><span>Bruno Henriques</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Akka</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/akka/akka_actors/>Akka Actors</a></li><li><a href=https://bphenriques.github.io/knowledge-base/akka/akka_cluster/>Akka Cluster</a></li><li><a href=https://bphenriques.github.io/knowledge-base/akka/akka_dispatcher/>Akka Dispatcher</a></li><li><a href=https://bphenriques.github.io/knowledge-base/akka/akka_router/>Akka Router</a></li><li><a href=https://bphenriques.github.io/knowledge-base/akka/akka_sharding/>Akka Sharding</a></li><li><a href=https://bphenriques.github.io/knowledge-base/akka/akka_streams/>Akka Streams</a></li><li><a href=https://bphenriques.github.io/knowledge-base/akka/akka_testing/>Akka Testing</a></li><li><a href=https://bphenriques.github.io/knowledge-base/akka/akka_overview/>Akka Overview</a></li></ul></li><li class=book-section-flat><span>Concurrency</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/concurrency/actor-model/>Actor Model</a></li><li><a href=https://bphenriques.github.io/knowledge-base/concurrency/amdah_s_law/>Amdah's Law</a></li><li><a href=https://bphenriques.github.io/knowledge-base/concurrency/gunther_s_universal_scalability_law/>Gunther's Universal Scalability Law</a></li></ul></li><li class=book-section-flat><span>Data Processing</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/data-processing/states-of-data/>States of Data</a></li></ul></li><li class=book-section-flat><span>Databases</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/databases/databases_overview/>Databases Overview</a></li><li><a href=https://bphenriques.github.io/knowledge-base/databases/databases_sharding-or-partitioning/>Sharding or Partitioning</a></li></ul></li><li class=book-section-flat><span>Documentation</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/documentation/readme/>Readme</a></li></ul></li><li class=book-section-flat><span>Editors</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/editors/emacs/>Emacs</a></li></ul></li><li class=book-section-flat><span>Learning</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/learning/coursera/>Coursera</a></li><li><a href=https://bphenriques.github.io/knowledge-base/learning/hands_on_scala_programming/>Hands-on Scala Programming</a></li><li><a href=https://bphenriques.github.io/knowledge-base/learning/technical_writing/>Technical Writing</a></li></ul></li><li class=book-section-flat><span>Messaging Systems</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/messaging-systems/messaging-systems-overview/>Messaging Systems Comparison</a></li></ul></li><li class=book-section-flat><span>Monitoring</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/monitoring/bug-management/>Bug Management</a></li></ul></li><li class=book-section-flat><span>Protocols</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/protocols/gossip_protocol/>Gossip Protocol</a></li><li><a href=https://bphenriques.github.io/knowledge-base/protocols/heartbeat/>Heartbeat</a></li></ul></li><li class=book-section-flat><span>Resources</span><ul></ul></li><li class=book-section-flat><span>Security</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/security/jwt/>JWT</a></li></ul></li><li class=book-section-flat><span>System Design</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/system-design/base_transaction/>BASE Transaction</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/command_query_responsibility_segregation/>Command Query Responsibility Segregation (CQRS)</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/command_sourcing/>Command Sourcing</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/consistency_and_availability/>Consistency And Availability</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/domain_driven_design/>Domain Driven Design</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/event_sourcing_es_es/ class=active>Event Sourcing (ES)</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/message_driven_architecture/>Message Driven Architecture</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/microservices/>Microservices</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/monolith/>Monolith</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/reactive_streams/>Reactive Streams</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/reactive_systems/>Reactive Systems</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/saga/>Saga</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/service_oriented_architecture_soa/>Service Oriented Architecture (SOA)</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/system-design_sli-slo/>SLI/SLO</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/system-design_stateless/>Stateless</a></li></ul></li><li class=book-section-flat><span>Work</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/work/curriculum/>Curriculum</a></li><li><a href=https://bphenriques.github.io/knowledge-base/work/random-memories/>Random Memories</a></li><li><a href=https://bphenriques.github.io/knowledge-base/work/thinking_tools/>Thinking Tools</a></li><li><a href=https://bphenriques.github.io/knowledge-base/work/way-of-work/>Way of work</a></li></ul></li><li class=book-section-flat><span>Snippets</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/snippets/gpg/>GPG</a></li><li><a href=https://bphenriques.github.io/knowledge-base/snippets/jackson/>Jackson</a></li></ul></li><li class=book-section-flat><span>Blog Ideas</span><ul></ul></li><li class=book-section-flat><span>Uncategorized</span><ul><li><a href=https://bphenriques.github.io/knowledge-base/uncategorized/nix/>Nix</a></li><li><a href=https://bphenriques.github.io/knowledge-base/uncategorized/web-stack-enties/>Stack Web Notes</a></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=https://bphenriques.github.io/knowledge-base/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Event Sourcing (ES)</strong>
<label for=toc-control><img src=https://bphenriques.github.io/knowledge-base/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#optimization-through-snapshots>Optimization through snapshots</a></li><li><a href=#versioning>Versioning</a></li><li><a href=#problems>Problems</a></li></ul></nav></aside></header><div class=backlinks><h3>Referred in:</h3><ul><li><a href=https://bphenriques.github.io/knowledge-base/system-design/command_query_responsibility_segregation/>Command Query Responsibility Segregation (CQRS)</a></li><li><a href=https://bphenriques.github.io/knowledge-base/system-design/command_sourcing/>Command Sourcing</a></li></ul></div><article class=markdown><p>Representing the application&rsquo;s state through the history of events that have happened in the past. Use cases:</p><ul><li><strong>Audit Logs</strong>: Build tailored reports from the event stream.</li><li><strong>Analytics</strong>: Extract behavior from the event stream.</li><li><strong>Temporal Reports</strong>: Build the timeline that led to a certain state.</li></ul><p>This is the opposite of regular applications where the final state is stored. In Event Sourced applications, the final state is called <code>Materialized State</code>. Whenever we need to obtain the current state we replay the logs until we reach the current state <strong>without replaying the side-effects</strong>. It is possible to keep both representation but that is complex and may become out-of-sync. Moreover, append-only operations are more efficient in databases.</p><pre><code class=language-nil data-lang=nil>Event1 -&gt; Event2 -&gt; Event3 ----&gt; Materialized State
</code></pre><p>As events become the source of truth, it is of utmost importance that they are immutables.</p><h2 id=optimization-through-snapshots>Optimization through snapshots
<a class=anchor href=#optimization-through-snapshots>#</a></h2><p>What happens if the list of events is too large?
<strong>Solution</strong>: Ocasionally persist a snapshot and we replay the events from that point on (issue: We may receive an event out-of-order, invalidating the snapshot).</p><h2 id=versioning>Versioning
<a class=anchor href=#versioning>#</a></h2><p>Issue when we have to change the event&rsquo;s schema. This leads to <code>ModelV1</code>, <code>ModelV2</code>, etc. This requires <span class=underline>supporting</span> all versions. And requires flexibile formats: JSON, ProtoBuf or AkkA Event Adapters in the lightbend ecosystem that is between the system and the DB translating the <code>V1</code>, <code>V2</code>, <code>VN</code> to the corresponding and unique Domain entity.</p><h2 id=problems>Problems
<a class=anchor href=#problems>#</a></h2><p>When we need to perform queries that involve several aggregate roots. Because entities need to be rebuilt from events everytime they are visited.</p><blockquote><p>The model used to persist are not compatible with the model required during queries.</p></blockquote><p>See <a href=https://bphenriques.github.io/knowledge-base/system-design/command_query_responsibility_segregation/>Command Query Responsibility Segregation</a>.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><div><a class="flex align-center" href=https://github.com/bphenriques/knowledge-base/edit/master/org/system-design/event_sourcing_es_es.org target=_blank rel=noopener><img src=https://bphenriques.github.io/knowledge-base/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#optimization-through-snapshots>Optimization through snapshots</a></li><li><a href=#versioning>Versioning</a></li><li><a href=#problems>Problems</a></li></ul></nav></div></aside></main></body></html>
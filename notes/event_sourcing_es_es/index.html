<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Representing the application&rsquo;s state through the history of events that have happened in the past. Use cases:
 Audit Logs: Build tailored reports from the event stream. Analytics: Extract behavior from the event stream. Temporal Reports: Build the timeline that led to a certain state.  This is the opposite of regular applications where the final state is stored. In Event Sourced applications, the final state is called Materialized State. Whenever we need to obtain the current state we replay the logs until we reach the current state without replaying the side-effects."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Event Sourcing (ES)"><meta property="og:description" content="Representing the application&rsquo;s state through the history of events that have happened in the past. Use cases:
 Audit Logs: Build tailored reports from the event stream. Analytics: Extract behavior from the event stream. Temporal Reports: Build the timeline that led to a certain state.  This is the opposite of regular applications where the final state is stored. In Event Sourced applications, the final state is called Materialized State. Whenever we need to obtain the current state we replay the logs until we reach the current state without replaying the side-effects."><meta property="og:type" content="article"><meta property="og:url" content="https://bphenriques.github.io/knowledge-base/notes/event_sourcing_es_es/"><meta property="article:section" content="notes"><title>Event Sourcing (ES) | Bruno Henriques's Digital Garden ðŸŒ±</title><link rel=icon href=/knowledge-base/favicon.png type=image/x-icon><link rel=stylesheet href=/knowledge-base/scss/explorer.min.fff1aaee6fb1e5a74069ac1205647344fa7bf178f7f20b3abcf095b18d0c24fe.css integrity="sha256-//Gq7m+x5adAaawSBWRzRPp78Xj38gs6vPCVsY0MJP4=" crossorigin=anonymous><script defer src=/knowledge-base/js/vendor/flexsearch.bundle.js></script><script defer src=/knowledge-base/js/search.min.73a19291761c071ff78abc5f5899d810691d46b13c6f658e86fac38510727b52.js integrity="sha256-c6GSkXYcBx/3irxfWJnYEGkdRrE8b2WOhvrDhRBye1I=" crossorigin=anonymous></script><script defer src=/knowledge-base/js/clipboard.min.14b9ccf5803971502776b44d95026b084e5fa02a544dc0e4cd86a7db76f691b2.js integrity="sha256-FLnM9YA5cVAndrRNlQJrCE5foCpUTcDkzYan23b2kbI=" crossorigin=anonymous></script></head><body><input type=checkbox class="hidden toggle" id=site-menu-control>
<input type=checkbox class="hidden toggle" id=content-menu-control><main class="container flex"><aside class=site-menu><div class=site-menu-content><nav><h2 class=brand><a class="flex align-center" href=/knowledge-base/><span>Bruno Henriques</span></a></h2><div class=search><input type=text id=search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="search-spinner hidden"></div><ul id=search-results class=item-preview-list></ul></div><a class=site-menu-shortcut-link href=/knowledge-base/notes>Recent Notes</a><p class=site-menu-tags-title><b>Tags</b></p><ul><li><a class=list-tag-item href=/knowledge-base/tags/akka><div class=tag-dot style=background-color:#ffecb3></div>Akka</a></li><li><a class=list-tag-item href=/knowledge-base/tags/concurrency><div class=tag-dot style=background-color:#f5f5f5></div>Concurrency</a></li><li><a class=list-tag-item href=/knowledge-base/tags/data><div class=tag-dot style=background-color:#ffe0b2></div>Data</a></li><li><a class=list-tag-item href=/knowledge-base/tags/data-structures><div class=tag-dot style=background-color:#ffcdd2></div>Data structures</a></li><li><a class=list-tag-item href=/knowledge-base/tags/databases><div class=tag-dot style=background-color:#f1f8e9></div>Databases</a></li><li><a class=list-tag-item href=/knowledge-base/tags/dispatcher><div class=tag-dot style=background-color:#c8e6c9></div>Dispatcher</a></li><li><a class=list-tag-item href=/knowledge-base/tags/editors><div class=tag-dot style=background-color:#ffb74d></div>Editors</a></li><li><a class=list-tag-item href=/knowledge-base/tags/fp><div class=tag-dot style=background-color:#80cbc4></div>Fp</a></li><li><a class=list-tag-item href=/knowledge-base/tags/functional-programming><div class=tag-dot style=background-color:#ffebee></div>Functional programming</a></li><li><a class=list-tag-item href=/knowledge-base/tags/io><div class=tag-dot style=background-color:#ffd180></div>Io</a></li><li><a class=list-tag-item href=/knowledge-base/tags/jq><div class=tag-dot style=background-color:#e1f5fe></div>Jq</a></li><li><a class=list-tag-item href=/knowledge-base/tags/json><div class=tag-dot style=background-color:#ffebee></div>JSON</a></li><li><a class=list-tag-item href=/knowledge-base/tags/jvm><div class=tag-dot style=background-color:#90caf9></div>Jvm</a></li><li><a class=list-tag-item href=/knowledge-base/tags/kotlin><div class=tag-dot style=background-color:#ffe57f></div>Kotlin</a></li><li><a class=list-tag-item href=/knowledge-base/tags/lightbend><div class=tag-dot style=background-color:#f0f4c3></div>Lightbend</a></li><li><a class=list-tag-item href=/knowledge-base/tags/monitoring><div class=tag-dot style=background-color:#e3f2fd></div>Monitoring</a></li><li><a class=list-tag-item href=/knowledge-base/tags/note><div class=tag-dot style=background-color:#bbdefb></div>Note</a></li><li><a class=list-tag-item href=/knowledge-base/tags/protocols><div class=tag-dot style=background-color:#ab9df2></div>Protocols</a></li><li><a class=list-tag-item href=/knowledge-base/tags/psql><div class=tag-dot style=background-color:#e0f2f1></div>Psql</a></li><li><a class=list-tag-item href=/knowledge-base/tags/queue><div class=tag-dot style=background-color:#ffebee></div>Queue</a></li><li><a class=list-tag-item href=/knowledge-base/tags/reference><div class=tag-dot style=background-color:#00bfa5></div>Reference</a></li><li><a class=list-tag-item href=/knowledge-base/tags/router><div class=tag-dot style=background-color:#c8e6c9></div>Router</a></li><li><a class=list-tag-item href=/knowledge-base/tags/scala><div class=tag-dot style=background-color:#ffd180></div>Scala</a></li><li><a class=list-tag-item href=/knowledge-base/tags/security><div class=tag-dot style=background-color:#b3e5fc></div>Security</a></li><li><a class=list-tag-item href=/knowledge-base/tags/signing><div class=tag-dot style=background-color:#ffd866></div>Signing</a></li><li><a class=list-tag-item href=/knowledge-base/tags/snippets><div class=tag-dot style=background-color:#e1f5fe></div>Snippets</a></li><li><a class=list-tag-item href=/knowledge-base/tags/stream><div class=tag-dot style=background-color:#d1c4e9></div>Stream</a></li><li><a class=list-tag-item href=/knowledge-base/tags/system-design><div class=tag-dot style=background-color:#ffebee></div>System design</a></li><li><a class=list-tag-item href=/knowledge-base/tags/uncategorized><div class=tag-dot style=background-color:#90caf9></div>Uncategorized</a></li><li><a class=list-tag-item href=/knowledge-base/tags/work><div class=tag-dot style=background-color:#f5f5f5></div>Work</a></li><li><a class=list-tag-item href=/knowledge-base/tags/zettelkasten><div class=tag-dot style=background-color:#e3f2fd></div>Zettelkasten</a></li></ul></nav></div></aside><div class=page><header class=mobile-navigation-header><div class="flex align-center justify-between"><label for=site-menu-control><img src=/knowledge-base/svg/menu-page.svg class=icon alt="Page Menu"></label>
<strong>Event Sourcing (ES)</strong>
<label for=content-menu-control><img src=/knowledge-base/svg/menu-content.svg class=icon alt="Content Menu"></label></div></header><article class=markdown><h1 class=post-title><a href=/knowledge-base/notes/event_sourcing_es_es/>Event Sourcing (ES)</a></h1><p>Representing the application&rsquo;s state through the history of events that have happened in the past. Use cases:</p><ul><li><strong>Audit Logs</strong>: Build tailored reports from the event stream.</li><li><strong>Analytics</strong>: Extract behavior from the event stream.</li><li><strong>Temporal Reports</strong>: Build the timeline that led to a certain state.</li></ul><p>This is the opposite of regular applications where the final state is stored. In Event Sourced applications, the final state is called <code>Materialized State</code>. Whenever we need to obtain the current state we replay the logs until we reach the current state <strong>without replaying the side-effects</strong>. It is possible to keep both representation but that is complex and may become out-of-sync. Moreover, append-only operations are more efficient in databases.</p><pre><code class=language-nil data-lang=nil>Event1 -&gt; Event2 -&gt; Event3 ----&gt; Materialized State
</code></pre><p>As events become the source of truth, it is of utmost importance that they are immutables.</p><h2 id=optimization-through-snapshots>Optimization through snapshots
<a class=anchor href=#optimization-through-snapshots>#</a></h2><p>What happens if the list of events is too large?
<strong>Solution</strong>: Ocasionally persist a snapshot and we replay the events from that point on (issue: We may receive an event out-of-order, invalidating the snapshot).</p><h2 id=versioning>Versioning
<a class=anchor href=#versioning>#</a></h2><p>Issue when we have to change the event&rsquo;s schema. This leads to <code>ModelV1</code>, <code>ModelV2</code>, etc. This requires <span class=underline>supporting</span> all versions. And requires flexibile formats: JSON, ProtoBuf or AkkA Event Adapters in the lightbend ecosystem that is between the system and the DB translating the <code>V1</code>, <code>V2</code>, <code>VN</code> to the corresponding and unique Domain entity.</p><h2 id=problems>Problems
<a class=anchor href=#problems>#</a></h2><p>When we need to perform queries that involve several aggregate roots. Because entities need to be rebuilt from events everytime they are visited.</p><blockquote><p>The model used to persist are not compatible with the model required during queries.</p></blockquote><p>See <a href=/knowledge-base/notes/command_query_responsibility_segregation/>Command Query Responsibility Segregation (CQRS)</a>
.</p></article><footer class=page-footer></footer><label for=site-menu-control class="hidden site-menu-overlay"></label><label for=content-menu-control class="hidden content-menu-overlay"></label></div><aside class=content-menu><div class=content-menu-content><div class=toc-tags><p class=toc-title>Tags</p><div class=list-item-tag style=background-color:#ffebee>System design</div></div><p class=toc-title>Table Of Contents</p><nav id=TableOfContents><ul><li><a href=#optimization-through-snapshots>Optimization through snapshots</a></li><li><a href=#versioning>Versioning</a></li><li><a href=#problems>Problems</a></li></ul></nav><nav class=backlinks><p class=toc-title>Mentioned In</p><ul class=item-preview-list><li><a href=/knowledge-base/notes/command_query_responsibility_segregation/><div class=item-preview><span class=item-preview-title>Command Query Responsibility Segregation (CQRS)</span><br><span class=item-preview-content>Command Query Responsibility Segregation (CQRS) is a architectural pattern that aims to â€¦</span></div></a></li><li><a href=/knowledge-base/notes/command_sourcing/><div class=item-preview><span class=item-preview-title>Command Sourcing</span><br><span class=item-preview-content>Command Sourcing # Similar to Event Sourcing (ES) but persists commands as opposed to â€¦</span></div></a></li></ul></nav></div></aside></main></body></html>